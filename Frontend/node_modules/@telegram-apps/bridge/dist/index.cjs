"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class h extends Error{constructor(t,r,n){super(typeof r=="object"?r.message:r||t,{cause:typeof r=="object"?r.cause:n}),this.type=t,this.name="TypedError",Object.setPrototypeOf(this,h.prototype)}}function te(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function Ne(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const De="ERR_INVALID_VALUE",Ce="ERR_UNEXPECTED_VALUE",Ue="ERR_UNEXPECTED_TYPE",re="ERR_PARSE";function ne(e,t){const r={};for(const n in e){const o=e[n];if(!o)continue;let s,a;typeof o=="function"?(s=n,a=o):[s,a]=o;try{const i=a(t(s));i!==void 0&&(r[n]=i)}catch(i){throw new h(re,`Parser for "${n}" property failed${s===n?"":`. Source field: "${s}"`}`,i)}}return r}function oe(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(r){throw new h(De,{cause:r})}if(typeof t!="object"||!t||Array.isArray(t))throw new h(Ce);return t}function m(e,t){return r=>{const n=o=>{if(!(r&&o===void 0))try{return t(o)}catch(s){throw new h(re,{message:`"${e}" transformer failed to parse the value`,cause:s})}};return Object.assign(n,{isValid(o){try{return n(o),!0}catch{return!1}}})}}function b(e,t){return m(t||"object",r=>{const n=oe(r);return ne(e,o=>n[o])})}function T(e){throw new h(Ue,`Unexpected value received: ${JSON.stringify(e)}`)}const $=m("boolean",e=>{if(typeof e=="boolean")return e;const t=String(e);if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;T(e)}),f=m("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();T(e)}),P=m("number",e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t))return t}T(e)}),Oe=m("date",e=>e instanceof Date?e:new Date(P()(e)*1e3));function se(e,t){return m(t||"searchParams",r=>{typeof r!="string"&&!(r instanceof URLSearchParams)&&T(r);const n=typeof r=="string"?new URLSearchParams(r):r;return ne(e,o=>{const s=n.get(o);return s===null?void 0:s})})}function W(e){for(const t in e)e[t]=[te(t),e[t]];return e}const je=e=>{const t=P(),r=P(!0),n=f(),o=f(!0),s=$(!0),a=b(W({addedToAttachmentMenu:s,allowsWriteToPm:s,firstName:n,id:t,isBot:s,isPremium:s,languageCode:o,lastName:o,photoUrl:o,username:o}),"User")(!0);return se(W({authDate:Oe(),canSendAfter:r,chat:b(W({id:t,type:n,title:n,photoUrl:o,username:o}),"Chat")(!0),chatInstance:o,chatType:o,hash:n,queryId:o,receiver:a,startParam:o,signature:n,user:a}),"initData")(e)};function We(e){return/^#[\da-f]{6}$/i.test(e)}function ke(e){return/^#[\da-f]{3}$/i.test(e)}function Me(e){const t=e.replace(/\s/g,"").toLowerCase();if(We(t))return t;if(ke(t)){let n="#";for(let o=0;o<3;o+=1)n+=t[1+o].repeat(2);return n}const r=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!r)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return r.slice(1).reduce((n,o)=>{const s=parseInt(o,10).toString(16);return n+(s.length===1?"0":"")+s},"#")}const xe=m("rgb",e=>Me(f()(e))),X=m("themeParams",e=>{const t=xe(!0);return Object.entries(oe(e)).reduce((r,[n,o])=>(r[Ne(n)]=t(o),r),{})});function M(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map(([t,r])=>[te(t),r])))}const Le=e=>{const t=f(),r=f(!0),n=$(!0);return se({botInline:["tgWebAppBotInline",n],defaultColors:["tgWebAppDefaultColors",X(!0)],fullscreen:["tgWebAppFullscreen",n],initData:["tgWebAppData",je(!0)],initDataRaw:["tgWebAppData",r],platform:["tgWebAppPlatform",t],showSettings:["tgWebAppShowSettings",n],startParam:["tgWebAppStartParam",r],themeParams:["tgWebAppThemeParams",X()],version:["tgWebAppVersion",t]},"launchParams")(e)};function qe(e){const{initDataRaw:t,startParam:r,showSettings:n,botInline:o,fullscreen:s,defaultColors:a}=e,i=new URLSearchParams;return i.set("tgWebAppPlatform",e.platform),i.set("tgWebAppThemeParams",M(e.themeParams)),i.set("tgWebAppVersion",e.version),t&&i.set("tgWebAppData",t),r&&i.set("tgWebAppStartParam",r),typeof n=="boolean"&&i.set("tgWebAppShowSettings",n?"1":"0"),typeof o=="boolean"&&i.set("tgWebAppBotInline",o?"1":"0"),typeof s=="boolean"&&i.set("tgWebAppFullscreen",s?"1":"0"),a&&i.set("tgWebAppDefaultColors",M(a)),i.toString()}const ae=b({eventType:f(),eventData:e=>e},"miniAppsMessage"),ie=m("fn",e=>{if(typeof e=="function")return e;T(e)});function Ie(e){return!!e&&typeof e=="object"&&!Array.isArray(e)}const Fe=b({TelegramWebviewProxy:b({postEvent:ie()})()});function q(e){return Fe().isValid(e)}function ce(){try{return window.self!==window.top}catch{return!0}}var He=Object.defineProperty,Je=(e,t,r)=>t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ue=(e,t,r)=>Je(e,typeof t!="symbol"?t+"":t,r);class l extends Error{constructor(t,r,n){super(typeof r=="object"?r.message:r||t,{cause:typeof r=="object"?r.cause:n}),this.type=t,this.name="TypedError",Object.setPrototypeOf(this,l.prototype)}}function I(e,t,r){return e.addEventListener(t,r),()=>e.removeEventListener(t,r)}function U(...e){const t=e.flat(1);return[t.push.bind(t),()=>{t.forEach(r=>{r()})}]}function Be(e,t){return e instanceof l&&e.type===t}function O(e){return t=>Be(t,e)}const F="ERR_ABORTED",H="ERR_CANCELED",J="ERR_TIMED_OUT";function x(e){return new l(F,{cause:e})}const Ge=O(J),Ve=O(F),Ke=O(H);function Y(e,t){return e.reject=t.reject,e}class g extends Promise{constructor(t,r){let n,o;typeof t=="function"?(n=t,o=r):o=t;let s,a;super((i,c)=>{o||(o={});const{abortSignal:u}=o;if(u&&u.aborted)return c(x(u.reason));const[_,w]=U(),d=E=>(...$e)=>(w(),E(...$e)),S=new AbortController,{signal:A}=S;a=d(E=>{S.abort(E),c(E)}),s=d(i),u&&_(I(u,"abort",()=>{a(x(u.reason))}));const{timeout:j}=o;if(j){const E=setTimeout(()=>{a(new l(J,`Timeout reached: ${j}ms`))},j);_(()=>{clearTimeout(E)})}n&&n(s,a,A)}),ue(this,"reject"),this.reject=a}static withFn(t,r){return new g((n,o,s)=>{try{const a=t(s);return a instanceof Promise?a.then(n,o):n(a)}catch(a){o(a)}},r)}static resolve(t){return new g(r=>{r(t)})}static reject(t){return new g((r,n)=>{n(t)})}cancel(){this.reject(new l(H))}catch(t){return this.then(void 0,t)}finally(t){return Y(super.finally(t),this)}then(t,r){return Y(super.then(t,r),this)}}function Q(e,t){return e.resolve=t.resolve,e}class v extends g{constructor(t,r){let n,o;typeof t=="function"?(n=t,o=r):o=t;let s;super((a,i,c)=>{s=a,n&&n(a,i,c)},o),ue(this,"resolve"),this.resolve=s}static withFn(t,r){return new v((n,o,s)=>g.withFn(t,{abortSignal:s}).then(n,o),r)}static resolve(t){return new v(r=>{r(t)})}static reject(t){return new v((r,n)=>{n(t)})}catch(t){return this.then(void 0,t)}finally(t){return Q(super.finally(t),this)}then(t,r){return Q(super.then(t,r),this)}}function Ze(e,t){return new g(r=>{setTimeout(r,e)},{abortSignal:t})}function pe(e){return`tapps/${e}`}function _e(e,t){sessionStorage.setItem(pe(e),JSON.stringify(t))}function fe(e){const t=sessionStorage.getItem(pe(e));try{return t?JSON.parse(t):void 0}catch{}}function ze(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function Xe(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function Ye(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}function le(e,t){t||(t={});const{textColor:r,bgColor:n,shouldLog:o=!0}=t;function s(a,...i){if(!o||typeof o=="function"&&!o())return;const c="font-weight:bold;padding:0 5px;border-radius:5px";console[a](`%c${Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date)}%c / %c${e}`,`${c};background-color: lightblue;color:black`,"",`${c};${r?`color:${r};`:""}${n?`background-color:${n}`:""}`,...i)}return[function(...a){s("log",...a)},function(...a){s("error",...a)}]}function Qe(e,t){document.documentElement.style.setProperty(e,t)}function et(e){document.documentElement.style.removeProperty(e)}function tt(e,t){t()}function y(e,t){t||(t={});const r=t.equals||Object.is;let n=[],o=e;const s=u=>{if(!r(o,u)){const _=o;o=u,tt(c,()=>{[...n].forEach(([w,d])=>{w(u,_),d&&i(w,!0)})})}};function a(u){const _=typeof u!="object"?{once:u}:u;return{once:_.once||!1,signal:_.signal||!1}}const i=(u,_)=>{const w=a(_),d=n.findIndex(([S,A])=>S===u&&A.once===w.once&&A.signal===w.signal);d>=0&&n.splice(d,1)},c=Object.assign(function(){return rt(c),o},{destroy(){n=[]},set:s,reset(){s(e)},sub(u,_){return n.push([u,a(_)]),()=>i(u,_)},unsub:i,unsubAll(){n=n.filter(u=>u[1].signal)}});return c}const k=[];function rt(e){k.length&&k[k.length-1].add(e)}const B=y(!1),[G,nt]=le("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog:B}),ot={clipboard_text_received:b({req_id:f(),data:e=>e===null?e:f(!0)(e)},"clipboard_text_received"),custom_method_invoked:b({req_id:f(),result:e=>e,error:f(!0)},"custom_method_invoked"),popup_closed:m("popup_closed",e=>e?b({button_id:t=>t==null?void 0:f()(t)})()(e):{}),viewport_changed:b({height:P(),width:e=>e==null?window.innerWidth:P()(e),is_state_stable:$(),is_expanded:$()},"viewport_changed")};function st(e){const t=window,[,r]=U(I(t,"message",n=>{if(n.source!==t.parent)return;let o;try{o=ae()(n.data)}catch{return}const{eventType:s,eventData:a}=o,i=ot[s];try{const c=i?i()(a):a;G("Event received:",c?{eventType:s,eventData:c}:{eventType:s}),e([s,c])}catch(c){nt([`An error occurred processing the "${s}" event from the Telegram application.`,"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join(`
`),o,c)}}));return r}const N=y(),D=y();function be(){return D()||D.set(st(N.set)),N}const R=y({});function ge(e){let t=R()[e];return t||(t=y(void 0,{equals(){return!1}}),be().sub(r=>{r&&r[0]===e&&t.set(r[1])}),R.set({...R(),[e]:t})),t}function me(e,t,r){return ge(e).sub(t,r)}const we="ERR_METHOD_UNSUPPORTED",de="ERR_RETRIEVE_LP_FAILED",he="ERR_METHOD_PARAMETER_UNSUPPORTED",Ee="ERR_UNKNOWN_ENV",ye="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",V=y("https://web.telegram.org");function K(e,t){G("Posting event:",t?{eventType:e,eventData:t}:{eventType:e});const r=window;if(q(r)){r.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));return}const n=JSON.stringify({eventType:e,eventData:t});if(ce())return r.parent.postMessage(n,V());const{external:o}=r;if(b({notify:ie()})().isValid(o)){o.notify(n);return}throw new l(Ee)}function Z(e,t,r){r||(r={});const{capture:n}=r,[o,s]=U();return new g(a=>{(Array.isArray(t)?t:[t]).forEach(i=>{o(me(i,c=>{(!n||(Array.isArray(t)?n({event:i,payload:c}):n(c)))&&a(c)}))}),(r.postEvent||K)(e,r.params)},r).finally(s)}function z(e){return Le()(e)}function ve(e){return z(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function at(){return ve(window.location.href)}function it(){const e=performance.getEntriesByType("navigation")[0];if(!e)throw new Error("Unable to get first navigation entry.");return ve(e.name)}const ct="launchParams";function ut(){return z(fe(ct)||"")}function Re(e){_e("launchParams",qe(e))}function Pe(e){return e instanceof Error?e.message+(e.cause?`
  ${Pe(e.cause)}`:""):JSON.stringify(e)}function Te(){const e=[];for(const t of[at,it,ut])try{const r=t();return Re(r),r}catch(r){e.push(r)}throw new l(de,["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","📖 Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-bridge/environment","Collected errors:",...e.map(t=>`— ${Pe(t)}`)].join(`
`))}function pt(e){if(e==="simple")try{return Te(),!0}catch{return!1}return g.withFn(async()=>{if(q(window))return!0;try{return await Z("web_app_request_theme","theme_changed",{timeout:100}),!0}catch{return!1}},e)}function C(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}function _t(e,t){if(typeof t=="string")try{const{eventType:r}=ae()(t);r==="web_app_request_theme"&&C("theme_changed",{theme_params:JSON.parse(M(e))}),r==="web_app_request_viewport"&&C("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}catch{}}function ft(e){var n;const t=typeof e=="string"?z(e):e;Re(t);const r=(n=window.TelegramWebviewProxy)==null?void 0:n.postEvent;window.TelegramWebviewProxy={postEvent(o,s){_t(t.themeParams,JSON.stringify({eventType:o,eventData:s})),r==null||r(o,s)}},G("Environment was mocked by the mockTelegramEnv function")}function lt(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((r,n,o)=>{if(n===o.length-1){t[r]=C;return}r in t||(t[r]={}),t=t[r]})})}function bt(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function gt(e,t,r){ge(e).unsub(t,r)}function mt(e,t){return be().sub(e,t)}function wt(e,t){N.unsub(e,t)}function Se(e){return({req_id:t})=>t===e}function ee(e){return e.split(".").map(Number)}function Ae(e,t){const r=ee(e),n=ee(t),o=Math.max(r.length,n.length);for(let s=0;s<o;s+=1){const a=r[s]||0,i=n[s]||0;if(a!==i)return a>i?1:-1}return 0}function p(e,t){return Ae(e,t)<=0}function L(e,t,r){if(typeof r=="string"){if(e==="web_app_open_link"){if(t==="try_instant_view")return p("6.4",r);if(t==="try_browser")return p("7.6",r)}if(e==="web_app_set_header_color"&&t==="color")return p("6.9",r);if(e==="web_app_close"&&t==="return_back")return p("7.6",r);if(e==="web_app_setup_main_button"&&t==="has_shine_effect")return p("7.10",r)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return p("6.1",t);case"web_app_open_popup":return p("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return p("6.4",t);case"web_app_switch_inline_query":return p("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return p("6.9",t);case"web_app_setup_settings_button":return p("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return p("7.2",t);case"web_app_setup_swipe_behavior":return p("7.7",t);case"web_app_share_to_story":return p("7.8",t);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return p("7.10",t);case"web_app_request_safe_area":case"web_app_request_content_safe_area":case"web_app_request_fullscreen":case"web_app_exit_fullscreen":case"web_app_set_emoji_status":case"web_app_add_to_home_screen":case"web_app_check_home_screen":case"web_app_request_emoji_status_access":return p("8.0",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function dt(e,t){t||(t="strict");const r=typeof t=="function"?t:n=>{const{method:o,version:s}=n;let a,i;if("param"in n?(a=`Parameter "${n.param}" of "${o}" method is unsupported in Mini Apps version ${s}`,i=he):(a=`Method "${o}" is unsupported in Mini Apps version ${s}`,i=we),t==="strict")throw new l(i,a);return console.warn(a)};return(n,o)=>L(n,e)?Ie(o)&&n==="web_app_set_header_color"&&"color"in o&&!L(n,"color",e)?r({version:e,method:n,param:"color"}):K(n,o):r({version:e,method:n})}function ht(e,t,r,n){return Z("web_app_invoke_custom_method","custom_method_invoked",{...n||{},params:{method:e,params:t,req_id:r},capture:Se(r)}).then(({result:o,error:s})=>{if(s)throw new l(ye,s);return o})}function Et(e){e.unsubAll(),e.reset()}function yt(){var e;(e=D())==null||e(),[...Object.values(R()),R,N,D,V,B].forEach(Et)}exports.$debug=B;exports.$targetOrigin=V;exports.CancelablePromise=g;exports.ERR_ABORTED=F;exports.ERR_CANCELED=H;exports.ERR_CUSTOM_METHOD_ERR_RESPONSE=ye;exports.ERR_METHOD_PARAMETER_UNSUPPORTED=he;exports.ERR_METHOD_UNSUPPORTED=we;exports.ERR_RETRIEVE_LP_FAILED=de;exports.ERR_TIMED_OUT=J;exports.ERR_UNKNOWN_ENV=Ee;exports.EnhancedPromise=v;exports.TypedError=l;exports.addEventListener=I;exports.camelToKebab=ze;exports.camelToSnake=Xe;exports.captureSameReq=Se;exports.compareVersions=Ae;exports.createAbortError=x;exports.createCbCollector=U;exports.createLogger=le;exports.createPostEvent=dt;exports.createTypedErrorPredicate=O;exports.defineEventHandlers=lt;exports.deleteCssVar=et;exports.emitMiniAppsEvent=C;exports.getStorageValue=fe;exports.hasWebviewProxy=q;exports.invokeCustomMethod=ht;exports.isAbortError=Ve;exports.isCanceledError=Ke;exports.isIframe=ce;exports.isTMA=pt;exports.isTimeoutError=Ge;exports.mockTelegramEnv=ft;exports.off=gt;exports.on=me;exports.postEvent=K;exports.removeEventHandlers=bt;exports.request=Z;exports.resetPackageState=yt;exports.retrieveLaunchParams=Te;exports.setCssVar=Qe;exports.setStorageValue=_e;exports.sleep=Ze;exports.snakeToCamel=Ye;exports.subscribe=mt;exports.supports=L;exports.unsubscribe=wt;
//# sourceMappingURL=index.cjs.map
