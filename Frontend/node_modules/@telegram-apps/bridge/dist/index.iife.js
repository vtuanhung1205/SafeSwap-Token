this.tapps=this.tapps||{};this.tapps.bridge=function(s){"use strict";class h extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,this.name="TypedError",Object.setPrototypeOf(this,h.prototype)}}function Q(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function Ne(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}const De="ERR_INVALID_VALUE",Ce="ERR_UNEXPECTED_VALUE",Ue="ERR_UNEXPECTED_TYPE",x="ERR_PARSE";function ee(e,t){const n={};for(const r in e){const o=e[r];if(!o)continue;let a,i;typeof o=="function"?(a=r,i=o):[a,i]=o;try{const c=i(t(a));c!==void 0&&(n[r]=c)}catch(c){throw new h(x,`Parser for "${r}" property failed${a===r?"":`. Source field: "${a}"`}`,c)}}return n}function te(e){let t=e;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){throw new h(De,{cause:n})}if(typeof t!="object"||!t||Array.isArray(t))throw new h(Ce);return t}function g(e,t){return n=>{const r=o=>{if(!(n&&o===void 0))try{return t(o)}catch(a){throw new h(x,{message:`"${e}" transformer failed to parse the value`,cause:a})}};return Object.assign(r,{isValid(o){try{return r(o),!0}catch{return!1}}})}}function m(e,t){return g(t||"object",n=>{const r=te(n);return ee(e,o=>r[o])})}function R(e){throw new h(Ue,`Unexpected value received: ${JSON.stringify(e)}`)}const A=g("boolean",e=>{if(typeof e=="boolean")return e;const t=String(e);if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;R(e)}),l=g("string",e=>{if(typeof e=="string"||typeof e=="number")return e.toString();R(e)}),P=g("number",e=>{if(typeof e=="number")return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t))return t}R(e)}),Oe=g("date",e=>e instanceof Date?e:new Date(P()(e)*1e3));function ne(e,t){return g(t||"searchParams",n=>{typeof n!="string"&&!(n instanceof URLSearchParams)&&R(n);const r=typeof n=="string"?new URLSearchParams(n):n;return ee(e,o=>{const a=r.get(o);return a===null?void 0:a})})}function W(e){for(const t in e)e[t]=[Q(t),e[t]];return e}const je=e=>{const t=P(),n=P(!0),r=l(),o=l(!0),a=A(!0),i=m(W({addedToAttachmentMenu:a,allowsWriteToPm:a,firstName:r,id:t,isBot:a,isPremium:a,languageCode:o,lastName:o,photoUrl:o,username:o}),"User")(!0);return ne(W({authDate:Oe(),canSendAfter:n,chat:m(W({id:t,type:r,title:r,photoUrl:o,username:o}),"Chat")(!0),chatInstance:o,chatType:o,hash:r,queryId:o,receiver:i,startParam:o,signature:r,user:i}),"initData")(e)};function We(e){return/^#[\da-f]{6}$/i.test(e)}function ke(e){return/^#[\da-f]{3}$/i.test(e)}function Me(e){const t=e.replace(/\s/g,"").toLowerCase();if(We(t))return t;if(ke(t)){let r="#";for(let o=0;o<3;o+=1)r+=t[1+o].repeat(2);return r}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((r,o)=>{const a=parseInt(o,10).toString(16);return r+(a.length===1?"0":"")+a},"#")}const Le=g("rgb",e=>Me(l()(e))),re=g("themeParams",e=>{const t=Le(!0);return Object.entries(te(e)).reduce((n,[r,o])=>(n[Ne(r)]=t(o),n),{})});function k(e){return JSON.stringify(Object.fromEntries(Object.entries(e).map(([t,n])=>[Q(t),n])))}const qe=e=>{const t=l(),n=l(!0),r=A(!0);return ne({botInline:["tgWebAppBotInline",r],defaultColors:["tgWebAppDefaultColors",re(!0)],fullscreen:["tgWebAppFullscreen",r],initData:["tgWebAppData",je(!0)],initDataRaw:["tgWebAppData",n],platform:["tgWebAppPlatform",t],showSettings:["tgWebAppShowSettings",r],startParam:["tgWebAppStartParam",n],themeParams:["tgWebAppThemeParams",re()],version:["tgWebAppVersion",t]},"launchParams")(e)};function Ie(e){const{initDataRaw:t,startParam:n,showSettings:r,botInline:o,fullscreen:a,defaultColors:i}=e,c=new URLSearchParams;return c.set("tgWebAppPlatform",e.platform),c.set("tgWebAppThemeParams",k(e.themeParams)),c.set("tgWebAppVersion",e.version),t&&c.set("tgWebAppData",t),n&&c.set("tgWebAppStartParam",n),typeof r=="boolean"&&c.set("tgWebAppShowSettings",r?"1":"0"),typeof o=="boolean"&&c.set("tgWebAppBotInline",o?"1":"0"),typeof a=="boolean"&&c.set("tgWebAppFullscreen",a?"1":"0"),i&&c.set("tgWebAppDefaultColors",k(i)),c.toString()}const oe=m({eventType:l(),eventData:e=>e},"miniAppsMessage"),ae=g("fn",e=>{if(typeof e=="function")return e;R(e)});function Fe(e){return!!e&&typeof e=="object"&&!Array.isArray(e)}const He=m({TelegramWebviewProxy:m({postEvent:ae()})()});function M(e){return He().isValid(e)}function se(){try{return window.self!==window.top}catch{return!0}}var Je=Object.defineProperty,Be=(e,t,n)=>t in e?Je(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ie=(e,t,n)=>Be(e,typeof t!="symbol"?t+"":t,n);class b extends Error{constructor(t,n,r){super(typeof n=="object"?n.message:n||t,{cause:typeof n=="object"?n.cause:r}),this.type=t,this.name="TypedError",Object.setPrototypeOf(this,b.prototype)}}function L(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function $(...e){const t=e.flat(1);return[t.push.bind(t),()=>{t.forEach(n=>{n()})}]}function Ge(e,t){return e instanceof b&&e.type===t}function N(e){return t=>Ge(t,e)}const q="ERR_ABORTED",I="ERR_CANCELED",F="ERR_TIMED_OUT";function H(e){return new b(q,{cause:e})}const Ve=N(F),Ke=N(q),Ze=N(I);function ce(e,t){return e.reject=t.reject,e}class w extends Promise{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let a,i;super((c,u)=>{o||(o={});const{abortSignal:_}=o;if(_&&_.aborted)return u(H(_.reason));const[f,d]=$(),E=v=>(...vt)=>(d(),v(...vt)),O=new AbortController,{signal:j}=O;i=E(v=>{O.abort(v),u(v)}),a=E(c),_&&f(L(_,"abort",()=>{i(H(_.reason))}));const{timeout:Y}=o;if(Y){const v=setTimeout(()=>{i(new b(F,`Timeout reached: ${Y}ms`))},Y);f(()=>{clearTimeout(v)})}r&&r(a,i,j)}),ie(this,"reject"),this.reject=i}static withFn(t,n){return new w((r,o,a)=>{try{const i=t(a);return i instanceof Promise?i.then(r,o):r(i)}catch(i){o(i)}},n)}static resolve(t){return new w(n=>{n(t)})}static reject(t){return new w((n,r)=>{r(t)})}cancel(){this.reject(new b(I))}catch(t){return this.then(void 0,t)}finally(t){return ce(super.finally(t),this)}then(t,n){return ce(super.then(t,n),this)}}function ue(e,t){return e.resolve=t.resolve,e}class T extends w{constructor(t,n){let r,o;typeof t=="function"?(r=t,o=n):o=t;let a;super((i,c,u)=>{a=i,r&&r(i,c,u)},o),ie(this,"resolve"),this.resolve=a}static withFn(t,n){return new T((r,o,a)=>w.withFn(t,{abortSignal:a}).then(r,o),n)}static resolve(t){return new T(n=>{n(t)})}static reject(t){return new T((n,r)=>{r(t)})}catch(t){return this.then(void 0,t)}finally(t){return ue(super.finally(t),this)}then(t,n){return ue(super.then(t,n),this)}}function ze(e,t){return new w(n=>{setTimeout(n,e)},{abortSignal:t})}function _e(e){return`tapps/${e}`}function pe(e,t){sessionStorage.setItem(_e(e),JSON.stringify(t))}function fe(e){const t=sessionStorage.getItem(_e(e));try{return t?JSON.parse(t):void 0}catch{}}function Xe(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function Ye(e){return e.replace(/[A-Z]/g,t=>`_${t.toLowerCase()}`)}function Qe(e){return e.replace(/_[a-z]/g,t=>t[1].toUpperCase())}function le(e,t){t||(t={});const{textColor:n,bgColor:r,shouldLog:o=!0}=t;function a(i,...c){if(!o||typeof o=="function"&&!o())return;const u="font-weight:bold;padding:0 5px;border-radius:5px";console[i](`%c${Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(new Date)}%c / %c${e}`,`${u};background-color: lightblue;color:black`,"",`${u};${n?`color:${n};`:""}${r?`background-color:${r}`:""}`,...c)}return[function(...i){a("log",...i)},function(...i){a("error",...i)}]}function xe(e,t){document.documentElement.style.setProperty(e,t)}function et(e){document.documentElement.style.removeProperty(e)}function tt(e,t){t()}function y(e,t){t||(t={});const n=t.equals||Object.is;let r=[],o=e;const a=_=>{if(!n(o,_)){const f=o;o=_,tt(u,()=>{[...r].forEach(([d,E])=>{d(_,f),E&&c(d,!0)})})}};function i(_){const f=typeof _!="object"?{once:_}:_;return{once:f.once||!1,signal:f.signal||!1}}const c=(_,f)=>{const d=i(f),E=r.findIndex(([O,j])=>O===_&&j.once===d.once&&j.signal===d.signal);E>=0&&r.splice(E,1)},u=Object.assign(function(){return nt(u),o},{destroy(){r=[]},set:a,reset(){a(e)},sub(_,f){return r.push([_,i(f)]),()=>c(_,f)},unsub:c,unsubAll(){r=r.filter(_=>_[1].signal)}});return u}const J=[];function nt(e){J.length&&J[J.length-1].add(e)}const B=y(!1),[G,rt]=le("Bridge",{bgColor:"#9147ff",textColor:"white",shouldLog:B}),ot={clipboard_text_received:m({req_id:l(),data:e=>e===null?e:l(!0)(e)},"clipboard_text_received"),custom_method_invoked:m({req_id:l(),result:e=>e,error:l(!0)},"custom_method_invoked"),popup_closed:g("popup_closed",e=>e?m({button_id:t=>t==null?void 0:l()(t)})()(e):{}),viewport_changed:m({height:P(),width:e=>e==null?window.innerWidth:P()(e),is_state_stable:A(),is_expanded:A()},"viewport_changed")};function at(e){const t=window,[,n]=$(L(t,"message",r=>{if(r.source!==t.parent)return;let o;try{o=oe()(r.data)}catch{return}const{eventType:a,eventData:i}=o,c=ot[a];try{const u=c?c()(i):i;G("Event received:",u?{eventType:a,eventData:u}:{eventType:a}),e([a,u])}catch(u){rt([`An error occurred processing the "${a}" event from the Telegram application.`,"Please, file an issue here:","https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose"].join(`
`),o,u)}}));return n}const D=y(),C=y();function be(){return C()||C.set(at(D.set)),D}const S=y({});function ge(e){let t=S()[e];return t||(t=y(void 0,{equals(){return!1}}),be().sub(n=>{n&&n[0]===e&&t.set(n[1])}),S.set({...S(),[e]:t})),t}function me(e,t,n){return ge(e).sub(t,n)}const we="ERR_METHOD_UNSUPPORTED",he="ERR_RETRIEVE_LP_FAILED",de="ERR_METHOD_PARAMETER_UNSUPPORTED",Ee="ERR_UNKNOWN_ENV",ye="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",V=y("https://web.telegram.org");function K(e,t){G("Posting event:",t?{eventType:e,eventData:t}:{eventType:e});const n=window;if(M(n)){n.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));return}const r=JSON.stringify({eventType:e,eventData:t});if(se())return n.parent.postMessage(r,V());const{external:o}=n;if(m({notify:ae()})().isValid(o)){o.notify(r);return}throw new b(Ee)}function Z(e,t,n){n||(n={});const{capture:r}=n,[o,a]=$();return new w(i=>{(Array.isArray(t)?t:[t]).forEach(c=>{o(me(c,u=>{(!r||(Array.isArray(t)?r({event:c,payload:u}):r(u)))&&i(u)}))}),(n.postEvent||K)(e,n.params)},n).finally(a)}function z(e){return qe()(e)}function ve(e){return z(e.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function st(){return ve(window.location.href)}function it(){const e=performance.getEntriesByType("navigation")[0];if(!e)throw new Error("Unable to get first navigation entry.");return ve(e.name)}const ct="launchParams";function ut(){return z(fe(ct)||"")}function Re(e){pe("launchParams",Ie(e))}function Pe(e){return e instanceof Error?e.message+(e.cause?`
  ${Pe(e.cause)}`:""):JSON.stringify(e)}function Te(){const e=[];for(const t of[st,it,ut])try{const n=t();return Re(n),n}catch(n){e.push(n)}throw new b(he,["Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside Telegram?","📖 Refer to docs for more information:","https://docs.telegram-mini-apps.com/packages/telegram-apps-bridge/environment","Collected errors:",...e.map(t=>`— ${Pe(t)}`)].join(`
`))}function _t(e){if(e==="simple")try{return Te(),!0}catch{return!1}return w.withFn(async()=>{if(M(window))return!0;try{return await Z("web_app_request_theme","theme_changed",{timeout:100}),!0}catch{return!1}},e)}function U(e,t){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:e,eventData:t}),source:window.parent}))}function pt(e,t){if(typeof t=="string")try{const{eventType:n}=oe()(t);n==="web_app_request_theme"&&U("theme_changed",{theme_params:JSON.parse(k(e))}),n==="web_app_request_viewport"&&U("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}catch{}}function ft(e){var r;const t=typeof e=="string"?z(e):e;Re(t);const n=(r=window.TelegramWebviewProxy)==null?void 0:r.postEvent;window.TelegramWebviewProxy={postEvent(o,a){pt(t.themeParams,JSON.stringify({eventType:o,eventData:a})),n==null||n(o,a)}},G("Environment was mocked by the mockTelegramEnv function")}function lt(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(e=>{let t=window;e.forEach((n,r,o)=>{if(r===o.length-1){t[n]=U;return}n in t||(t[n]={}),t=t[n]})})}function bt(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(e=>{delete window[e]})}function gt(e,t,n){ge(e).unsub(t,n)}function mt(e,t){return be().sub(e,t)}function wt(e,t){D.unsub(e,t)}function Se(e){return({req_id:t})=>t===e}function Ae(e){return e.split(".").map(Number)}function $e(e,t){const n=Ae(e),r=Ae(t),o=Math.max(n.length,r.length);for(let a=0;a<o;a+=1){const i=n[a]||0,c=r[a]||0;if(i!==c)return i>c?1:-1}return 0}function p(e,t){return $e(e,t)<=0}function X(e,t,n){if(typeof n=="string"){if(e==="web_app_open_link"){if(t==="try_instant_view")return p("6.4",n);if(t==="try_browser")return p("7.6",n)}if(e==="web_app_set_header_color"&&t==="color")return p("6.9",n);if(e==="web_app_close"&&t==="return_back")return p("7.6",n);if(e==="web_app_setup_main_button"&&t==="has_shine_effect")return p("7.10",n)}switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return p("6.1",t);case"web_app_open_popup":return p("6.2",t);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return p("6.4",t);case"web_app_switch_inline_query":return p("6.7",t);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return p("6.9",t);case"web_app_setup_settings_button":return p("6.10",t);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return p("7.2",t);case"web_app_setup_swipe_behavior":return p("7.7",t);case"web_app_share_to_story":return p("7.8",t);case"web_app_setup_secondary_button":case"web_app_set_bottom_bar_color":return p("7.10",t);case"web_app_request_safe_area":case"web_app_request_content_safe_area":case"web_app_request_fullscreen":case"web_app_exit_fullscreen":case"web_app_set_emoji_status":case"web_app_add_to_home_screen":case"web_app_check_home_screen":case"web_app_request_emoji_status_access":return p("8.0",t);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(e)}}function ht(e,t){t||(t="strict");const n=typeof t=="function"?t:r=>{const{method:o,version:a}=r;let i,c;if("param"in r?(i=`Parameter "${r.param}" of "${o}" method is unsupported in Mini Apps version ${a}`,c=de):(i=`Method "${o}" is unsupported in Mini Apps version ${a}`,c=we),t==="strict")throw new b(c,i);return console.warn(i)};return(r,o)=>X(r,e)?Fe(o)&&r==="web_app_set_header_color"&&"color"in o&&!X(r,"color",e)?n({version:e,method:r,param:"color"}):K(r,o):n({version:e,method:r})}function dt(e,t,n,r){return Z("web_app_invoke_custom_method","custom_method_invoked",{...r||{},params:{method:e,params:t,req_id:n},capture:Se(n)}).then(({result:o,error:a})=>{if(a)throw new b(ye,a);return o})}function Et(e){e.unsubAll(),e.reset()}function yt(){var e;(e=C())==null||e(),[...Object.values(S()),S,D,C,V,B].forEach(Et)}return s.$debug=B,s.$targetOrigin=V,s.CancelablePromise=w,s.ERR_ABORTED=q,s.ERR_CANCELED=I,s.ERR_CUSTOM_METHOD_ERR_RESPONSE=ye,s.ERR_METHOD_PARAMETER_UNSUPPORTED=de,s.ERR_METHOD_UNSUPPORTED=we,s.ERR_RETRIEVE_LP_FAILED=he,s.ERR_TIMED_OUT=F,s.ERR_UNKNOWN_ENV=Ee,s.EnhancedPromise=T,s.TypedError=b,s.addEventListener=L,s.camelToKebab=Xe,s.camelToSnake=Ye,s.captureSameReq=Se,s.compareVersions=$e,s.createAbortError=H,s.createCbCollector=$,s.createLogger=le,s.createPostEvent=ht,s.createTypedErrorPredicate=N,s.defineEventHandlers=lt,s.deleteCssVar=et,s.emitMiniAppsEvent=U,s.getStorageValue=fe,s.hasWebviewProxy=M,s.invokeCustomMethod=dt,s.isAbortError=Ke,s.isCanceledError=Ze,s.isIframe=se,s.isTMA=_t,s.isTimeoutError=Ve,s.mockTelegramEnv=ft,s.off=gt,s.on=me,s.postEvent=K,s.removeEventHandlers=bt,s.request=Z,s.resetPackageState=yt,s.retrieveLaunchParams=Te,s.setCssVar=xe,s.setStorageValue=pe,s.sleep=ze,s.snakeToCamel=Qe,s.subscribe=mt,s.supports=X,s.unsubscribe=wt,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),s}({});
//# sourceMappingURL=index.iife.js.map
